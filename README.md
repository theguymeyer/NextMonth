# NextMonth — Freelance Cashflow PWA

A lightweight PWA you can develop on your phone (or desktop), import monthly CSV statements, classify transactions as **foreseeable/unforeseeable**, categorize income/expenses, and get **allocation suggestions** to build a safety buffer and invest the surplus.

## Features
- CSV ingest in-browser (PapaParse).
- Classify foreseeable vs unforeseeable.
- Categorize items, manage custom categories.
- Month snapshot & suggested reserve/invest split using variability-aware buffer.
- Works offline (service worker + localStorage). Optional cloud sync via Supabase.
- Standard CSS (no Tailwind).

## Quick start (no build step)
1. Host the folder contents (e.g. Netlify, Vercel, GitHub Pages, or any static host).
2. Open in Safari on iPhone, tap **Share → Add to Home Screen** to install the PWA.
3. Use entirely offline, or connect Supabase in the app header.

> You can also test locally by serving the folder. On desktop: `python3 -m http.server 8080` and go to `http://localhost:8080`.

## CSV expected columns
Any CSV with headers that include some combination of:
- `date` or `transaction date` or `posted`
- `description` or `memo` or `details`
- `amount` (or `debit` + `credit` will be combined into a single amount)

Amounts: positive = income, negative = expense (you can override by ticking “Income?”).

## Recommended budgeting logic (built-in)
- **Buffer target** = 90th percentile of *unforeseeable* spend over the last 12 months + avg(6 months) of foreseeable expenses.
- **Reserve this month** = at least one-third of the buffer gap (but not more than the month’s surplus).
- **Investable now** = max(0, surplus − reserve).
- History is read from locally saved months; when Supabase is connected, save goes to `transactions` table as well.

## Supabase setup (optional sync)
1. Create a Supabase project → copy **Project URL** and **Anon key** into the app.
2. Create table `transactions` with Row Level Security **enabled**.

```sql
create table if not exists public.transactions (
  id bigint generated by default as identity primary key,
  month text not null,
  date date not null,
  description text not null,
  amount numeric not null,
  foreseeable boolean not null default false,
  category text,
  is_income boolean not null default false,
  user_id uuid null default auth.uid(),
  inserted_at timestamp with time zone default now()
);
alter table public.transactions enable row level security;
create policy "users read own" on public.transactions
  for select using (auth.uid() = user_id or user_id is null);
create policy "users write own" on public.transactions
  for insert with check (auth.uid() = user_id or user_id is null);
```

> If you want multi-user isolation, require `user_id` to be not null and set it in the app after adding Supabase Auth.

## Deploy
- **No-build route (easiest):** Drop the folder on Netlify → set site domain → open on iPhone → Add to Home Screen.
- **With custom domain/HTTPS:** Ensure service worker is served over HTTPS (most hosts do this by default).

## Roadmap ideas
- IndexedDB for large datasets.
- Trend charts per category.
- EMA smoothing for forecasts and seasonality controls.
- Buckets/Envelopes and auto-sweeps to investment account via API.

---

**Security note:** This app can run fully offline and store data locally. If you enable Supabase, data goes to your project. Always use HTTPS.
